<!DOCTYPE html>
<html>
<head>
    <title>Kottans:Pokedex</title>
    <link rel="stylesheet" type="text/css" href="bootstrap.min.css">
    <style type="text/css">
        img.center{  
            display: block;
            margin: 5px auto;
        }
        .card{
            min-height: 200px;
        }
        .types span {
            padding: 5px;
        }
    </style>
    <script src = "http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
    <script src = "http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular-route.min.js"></script>
</head>

<body>
    <div class="container">
        <div ng-app = "pokeList"  ng-controller = "pokeController">
            <h1 class="text-center">Pokedex</h1>
            <div class="row">
                <div class="col-md-9">
                    <div class="row">
                        <div class="col-md-4 card" ng-repeat = "pokemon in pokeDex.pokemons">
                            <img class="center" src="http://pokeapi.co/media/img/{{pokemon.pkdx_id}}.png">
                            <p class="text-center">{{pokemon.name}}</p>
                            <a href = "#{{pokemon.pkdx_id}}">view</a>
                            <div class="types">
                                <span class="{{type.name}}" ng-repeat = "type in pokemon.types">{{type.name}}</span>
                            </div>
                        </div>
                        <button class="btn btn-block btn-primary" ng-click="pokeDex.getNextChunk()">Load More</button>
                    </div>
                </div>
                <div class="col-md-3" ng-view></div>
                <script type = "text/ng-template" id = "pokeDetails.html">
                    <h2> Detailed view </h2>
                    <img class="center" src="http://pokeapi.co/media/img/{{poke.details.pkdx_id}}.png">
                    <p>#{{poke.details.pkdx_id}}</p>
                    <div class="types">
                        <span class="{{type.name}}" ng-repeat = "type in poked.details.types">{{type.name}}</span>
                    </div>
                 </script>
            </div>
        </div>
    </div>

    <script>
        var mainApp = angular.module("pokeList", ['ngRoute']);
        mainApp.config(['$routeProvider', function($routeProvider) {
            $routeProvider.
            
            when('/:pokemonId', {
               templateUrl: 'pokeDetails.html',
               controller: 'ViewPokemonController',
                controllerAs: "poke"
            }).
            
            otherwise({
               redirectTo: '/'
            });
        }]);
         
        mainApp.controller('pokeController', function($scope, $http) {
            $scope.pokeDex = {
                pokemons : [],
                pokeApiDomain: "http://pokeapi.co/",
                chunkUrl:"api/v1/pokemon/?limit=12",
                getNextChunk : function () {
                    var nextChunkUrl = this.pokeApiDomain+this.chunkUrl;
                    $http.get(nextChunkUrl)
                    .then(function(response) {
                        //First function handles success
                        $scope.pokeDex.pokemons = $scope.pokeDex.pokemons.concat(response.data.objects);
                        $scope.pokeDex.chunkUrl = response.data.meta.next;
                        console.log(response.data);
                    }, function(response) {
                        //Second function handles error
                        $scope.content = "Something went wrong";
                        console.log(response.data);
                    });
                    console.log(this.chunkUrl);
                }
            };

            $scope.pokeDex.getNextChunk();

        });

        mainApp.controller('ViewPokemonController', function($routeParams,$http) {
            var detailsDataUrl = "http://pokeapi.co/api/v1/pokemon/"+$routeParams.pokemonId;
            var self = this;
            $http.get(detailsDataUrl)
            .then(function(response) {
                self.details = response.data;
                console.log(response);
            }, function(response) {
                //Second function handles error
                $scope.content = "Something went wrong";
                console.log(response.data);
            });
            //self.message = $routeParams.pokemonId;
        });
    </script>
  
</body>
</html>
